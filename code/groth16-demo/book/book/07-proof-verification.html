<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Proof Verification - Groth16 Zero-Knowledge Proofs: From Theory to Implementation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A comprehensive tutorial on Groth16 with rigorous mathematical detail and practical Rust implementation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Groth16 Zero-Knowledge Proofs: From Theory to Implementation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/boycrypt/website" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/boycrypt/website/edit/main/code/groth16-demo/book/src/07-proof-verification.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="proof-verification"><a class="header" href="#proof-verification">Proof Verification</a></h1>
<p>We've generated our proof. Now the verifier needs to check that it's valid without learning anything about the witness. This is where the pairing equation comes in!</p>
<h2 id="learning-objectives"><a class="header" href="#learning-objectives">Learning Objectives</a></h2>
<p>After this chapter, you will understand:</p>
<ul>
<li>The Groth16 verification equation</li>
<li>How pairings enable efficient verification</li>
<li>Constant-time verification regardless of circuit size</li>
<li>Batch verification for efficiency</li>
<li>Security properties of verification</li>
</ul>
<h2 id="motivating-example-the-verification-check"><a class="header" href="#motivating-example-the-verification-check">Motivating Example: The Verification Check</a></h2>
<p>The prover sends:</p>
<ul>
<li>Proof π = (A, B, C)</li>
<li>Public inputs (e.g., c = 12 for the multiplier)</li>
</ul>
<p>The verifier needs to check:</p>
<ol>
<li>The proof was generated correctly</li>
<li>The public inputs match the witness</li>
<li>The witness satisfies all constraints</li>
<li>No information about the witness is leaked</li>
</ol>
<p><strong>All in constant time!</strong></p>
<h2 id="theory-deep-dive-the-verification-equation"><a class="header" href="#theory-deep-dive-the-verification-equation">Theory Deep Dive: The Verification Equation</a></h2>
<h3 id="the-pairing-equation"><a class="header" href="#the-pairing-equation">The Pairing Equation</a></h3>
<p>A Groth16 proof is valid if and only if:</p>
<pre><code class="language-text">e(A, B) = e(α, β) · e(Σ publicᵢ·ICᵢ, γ) · e(C, δ)
</code></pre>
<p>Where:</p>
<ul>
<li><strong>e(·, ·)</strong> is the bilinear pairing</li>
<li><strong>A, B, C</strong> are the proof components</li>
<li><strong>α, β, γ, δ</strong> are from the verification key</li>
<li><strong>ICᵢ</strong> are the input consistency elements</li>
<li><strong>publicᵢ</strong> are the public inputs</li>
</ul>
<h3 id="expanding-the-equation"><a class="header" href="#expanding-the-equation">Expanding the Equation</a></h3>
<p>Let's expand what each component means:</p>
<p><strong>Left side</strong>:</p>
<pre><code class="language-text">e(A, B) = e(α·G₁ + A_witness + r·δ·G₁, β·G₂ + B_witness + s·δ·G₂)
</code></pre>
<p><strong>Right side</strong>:</p>
<pre><code class="language-text">e(α, β) · e(Σ public·IC, γ) · e(C, δ)
</code></pre>
<p>When the proof is correctly generated, these two sides are equal!</p>
<h3 id="why-this-works"><a class="header" href="#why-this-works">Why This Works</a></h3>
<p>The verification equation checks three things:</p>
<ol>
<li><strong>Proof structure</strong>: A and B use the correct secrets (α, β, δ)</li>
<li><strong>Public input consistency</strong>: The witness matches the claimed public inputs</li>
<li><strong>QAP satisfaction</strong>: The division polynomial H(x) exists</li>
</ol>
<p>If any of these fail, the pairing equation won't hold!</p>
<h3 id="the-public-input-term"><a class="header" href="#the-public-input-term">The Public Input Term</a></h3>
<p>The term <strong>e(Σ publicᵢ·ICᵢ, γ)</strong> ensures public input consistency:</p>
<pre><code class="language-text">IC[0] = β·G₁ (for the constant 1)
IC[i] = β·Aᵢ(τ)·G₁ for i = 1..num_inputs

Σ publicᵢ·ICᵢ = public₀·IC[0] + public₁·IC[1] + ...
              = 1·β·G₁ + c·β·A₁(τ)·G₁
              = β·(1 + c·A₁(τ))·G₁
</code></pre>
<p>This ensures the witness used the correct public inputs!</p>
<h2 id="implementation-verification-in-rust"><a class="header" href="#implementation-verification-in-rust">Implementation: Verification in Rust</a></h2>
<p>Now let's see how verification is implemented.</p>
<h3 id="the-main-verification-function"><a class="header" href="#the-main-verification-function">The Main Verification Function</a></h3>
<p>From <code>crates/groth16/src/verify.rs:66-167</code>:</p>
<pre><code class="language-rust ignore">/// Verifies a Groth16 zero-knowledge proof.
pub fn verify_proof(
    vk: &amp;VerificationKey,
    proof: &amp;Proof,
    public_inputs: &amp;[FieldWrapper&lt;Fq&gt;],
) -&gt; Result&lt;bool, Groth16Error&gt; {
    // Helper function to convert FieldWrapper&lt;Fq&gt; to Fr
    fn fq_to_fr(fq: &amp;Fq) -&gt; &lt;Bn254 as Pairing&gt;::ScalarField {
        let bytes = fq.into_bigint().to_bytes_be();
        let mut padded = [0u8; 32];
        let start = 32usize.saturating_sub(bytes.len());
        padded[start..].copy_from_slice(&amp;bytes);
        &lt;Bn254 as Pairing&gt;::ScalarField::from_be_bytes_mod_order(&amp;padded)
    }

    // Step 1: Compute left side of verification equation
    // Left side: e(A, B)
    let left = Bn254::pairing(proof.a, proof.b);

    // Step 2: Compute right side components
    // Component 1: e(α, β)
    let alpha_beta = Bn254::pairing(vk.alpha_g1, vk.beta_g2);

    // Component 2: e(Σpublic_i·IC_i, γ)
    // Check if IC includes the constant (IC length = public_inputs + 1)
    let has_constant = vk.ic.len() == public_inputs.len() + 1;

    let mut public_acc = G1::zero();

    if has_constant {
        // IC[0] is for constant 1, IC[1..] are for public inputs
        if !vk.ic.is_empty() {
            public_acc += G1::from(vk.ic[0]);
        }
        for (i, input) in public_inputs.iter().enumerate() {
            if i + 1 &lt; vk.ic.len() {
                let input_scalar = fq_to_fr(&amp;input.value);
                let ic_point = G1::from(vk.ic[i + 1]);
                public_acc += ic_point * input_scalar;
            }
        }
    }

    let public_gamma = Bn254::pairing(public_acc, vk.gamma_g2);

    // Component 3: e(C, δ)
    let c_delta = Bn254::pairing(proof.c, vk.delta_g2);

    // Right side: e(α, β) · e(Σpublic·IC, γ) · e(C, δ)
    let right_field = alpha_beta.0 * public_gamma.0 * c_delta.0;

    // Step 3: Check if verification equation holds
    let is_valid = left.0 == right_field;

    Ok(is_valid)
}</code></pre>
<h3 id="the-verification-algorithm"><a class="header" href="#the-verification-algorithm">The Verification Algorithm</a></h3>
<ol>
<li><strong>Compute left side</strong>: <code>e(A, B)</code> using the pairing</li>
<li><strong>Compute right side</strong>:
<ul>
<li><code>e(α, β)</code> from the verification key</li>
<li><code>e(Σpublic·IC, γ)</code> by combining public inputs with IC elements</li>
<li><code>e(C, δ)</code> from the proof and verification key</li>
</ul>
</li>
<li><strong>Multiply the right side components</strong>: <code>e(α, β) · e(Σpublic·IC, γ) · e(C, δ)</code></li>
<li><strong>Compare</strong>: Check if left equals right</li>
</ol>
<h2 id="running-the-code"><a class="header" href="#running-the-code">Running the Code</a></h2>
<h3 id="example-verifying-a-proof"><a class="header" href="#example-verifying-a-proof">Example: Verifying a Proof</a></h3>
<pre><code class="language-rust ignore">use groth16_groth16::{trusted_setup, generate_proof, verify_proof};
use groth16_circuits::multiplier::MultiplierCircuit;
use groth16_qap::r1cs_to_qap;

// Setup and proof generation
let circuit = MultiplierCircuit::new(3, 4, 12);
let witness = circuit.witness();
let constraints = circuit.to_r1cs();
let (a_polys, b_polys, c_polys) = r1cs_to_qap(&amp;constraints, 4)?;
let (pk, vk) = trusted_setup(&amp;a_polys, &amp;b_polys, &amp;c_polys, 1, &amp;mut rng)?;
let proof = generate_proof(&amp;pk, &amp;witness, &amp;a_polys, &amp;b_polys, &amp;c_polys, 1, &amp;mut rng)?;

// Verify with public input c=12
let public_inputs = vec![FieldWrapper::&lt;Fq&gt;::from(12u64)];
let is_valid = verify_proof(&amp;vk, &amp;proof, &amp;public_inputs)?;

assert!(is_valid);  // Proof should be valid
println!("Proof verification: {}", is_valid);</code></pre>
<h3 id="example-invalid-proof"><a class="header" href="#example-invalid-proof">Example: Invalid Proof</a></h3>
<pre><code class="language-rust ignore">// Try to verify with wrong public input
let wrong_public_inputs = vec![FieldWrapper::&lt;Fq&gt;::from(13u64)];  // Should be 12
let is_valid = verify_proof(&amp;vk, &amp;proof, &amp;wrong_public_inputs)?;

assert!(!is_valid);  // Proof should be invalid</code></pre>
<h2 id="efficiency"><a class="header" href="#efficiency">Efficiency</a></h2>
<h3 id="constant-time-verification"><a class="header" href="#constant-time-verification">Constant-Time Verification</a></h3>
<p>Verification is <strong>O(1)</strong> regardless of circuit size:</p>
<ul>
<li>3 pairing operations (constant time)</li>
<li>O(n) field multiplications for public inputs (usually small n)</li>
<li>No computation over constraints!</li>
</ul>
<p>For a circuit with 1 million constraints:</p>
<ul>
<li>Proving time: O(n) ~ several seconds</li>
<li>Verification time: O(1) ~ a few milliseconds</li>
</ul>
<h3 id="batch-verification"><a class="header" href="#batch-verification">Batch Verification</a></h3>
<p>We can verify multiple proofs efficiently using random linear combination:</p>
<p>From <code>crates/groth16/src/verify.rs:169-240</code>:</p>
<pre><code class="language-rust ignore">/// Batch verifies multiple Groth16 proofs efficiently using random linear combination.
///
/// Instead of O(n) pairing operations for n proofs, we use O(1) pairings total.
pub fn batch_verify&lt;R: Rng&gt;(
    vk: &amp;VerificationKey,
    proofs: &amp;[Proof],
    public_inputs_list: &amp;[Vec&lt;FieldWrapper&lt;Fq&gt;&gt;],
    rng: &amp;mut R,
) -&gt; Result&lt;bool, Groth16Error&gt;
{
    // Generate random coefficients for each proof
    let mut coeffs = Vec::with_capacity(proofs.len());
    for _ in 0..proofs.len() {
        let r = Fr::rand(rng);
        coeffs.push(r);
    }

    // Compute combined left side: e(Σ rᵢ·Aᵢ, Bᵢ)
    let mut combined_a = G1::zero();
    for (i, proof) in proofs.iter().enumerate() {
        combined_a += G1::from(proof.a) * coeffs[i];
    }
    let left = Bn254::pairing(combined_a, proofs[0].b);

    // Compute combined right side
    // ... (similar combination for right side)

    // Single pairing check for all proofs
    Ok(left.0 == right.0)
}</code></pre>
<p><strong>Speedup</strong>: For n proofs:</p>
<ul>
<li>Individual: ~3n pairings</li>
<li>Batch: ~3 pairings (constant!)</li>
<li>Speedup: Approximately n× faster</li>
</ul>
<h2 id="security-properties"><a class="header" href="#security-properties">Security Properties</a></h2>
<h3 id="soundness"><a class="header" href="#soundness">Soundness</a></h3>
<p>A false proof will be rejected with overwhelming probability:</p>
<ul>
<li>The pairing equation would fail</li>
<li>Cannot forge without knowing toxic waste</li>
<li>Cryptographic assumptions: ECDLP, SDH</li>
</ul>
<h3 id="zero-knowledge"><a class="header" href="#zero-knowledge">Zero-Knowledge</a></h3>
<p>Verification reveals nothing about the witness:</p>
<ul>
<li>Only public inputs and the proof are visible</li>
<li>Pairings don't leak information about discrete logs</li>
<li>Blinding factors (r, s) ensure proof diversity</li>
</ul>
<h3 id="succinctness"><a class="header" href="#succinctness">Succinctness</a></h3>
<p>Verification is incredibly efficient:</p>
<ul>
<li>Constant-time regardless of circuit complexity</li>
<li>Small proof size (128 bytes)</li>
<li>Fast verification (~milliseconds)</li>
</ul>
<h2 id="connection-to-groth16"><a class="header" href="#connection-to-groth16">Connection to Groth16</a></h2>
<p>Verification is the <strong>final step</strong> of Groth16:</p>
<pre><code class="language-text">Computation
    ↓
R1CS (matrix constraints)
    ↓
QAP (polynomial divisibility)
    ↓
Elliptic Curve Pairings
    ↓
Trusted Setup
    ↓
Proof Generation
    ↓
Proof Verification ← You are here
</code></pre>
<h2 id="exercises"><a class="header" href="#exercises">Exercises</a></h2>
<ol>
<li>
<p><strong>Verification equation</strong>:</p>
<pre><code class="language-text">Why do we need e(α, β) on the right side?
What would happen if we removed it?
</code></pre>
</li>
<li>
<p><strong>Public input consistency</strong>:</p>
<pre><code class="language-text">How does the IC vector ensure public inputs are correct?
What happens if the prover lies about public inputs?
</code></pre>
</li>
<li>
<p><strong>Batch verification</strong>:</p>
<pre><code class="language-text">Why does batch verification work?
What's the security requirement for the random coefficients?
</code></pre>
</li>
<li>
<p><strong>Challenge question</strong>:</p>
<pre><code class="language-text">Can we verify a proof without the verification key?
What parts of the VK are essential?
</code></pre>
</li>
</ol>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li><strong>Pairing Verification</strong>: <a href="https://www.cryptologie.net/article/328/pairing-based-cryptography/">Pairing-Based Cryptography</a></li>
<li><strong>Batch Verification</strong>: <a href="https://eprint.iacr.org/2020/1628">Batch Verification Techniques</a></li>
<li><strong>Groth16 Security</strong>: <a href="https://eprint.iacr.org/2016/260">Groth16 Security Proof</a></li>
</ul>
<hr />
<p><strong>Ready to build circuits? Continue to <a href="./08-building-circuits.html">Chapter 8: Building Your Own Circuits</a></strong></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="06-proof-generation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="08-building-circuits.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="06-proof-generation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="08-building-circuits.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
