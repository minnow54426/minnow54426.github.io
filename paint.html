<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paint Gallery</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 16px;
            background: #0066cc;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .back-link:hover {
            background: #0052a3;
        }

        .gallery-container {
            margin-bottom: 20px;
        }

        .folder-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 12px 18px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #0066cc;
            border-radius: 8px;
            margin: 20px 0 10px 0;
            transition: all 0.3s ease;
        }

        .folder-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.15);
        }

        .folder-title {
            font-size: 1.4em;
            color: #333;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .folder-arrow {
            font-size: 1.2em;
            color: #0066cc;
            transition: transform 0.3s ease;
        }

        .folder-arrow.open {
            transform: rotate(90deg);
        }

        .item-count {
            background: #0066cc;
            color: white;
            padding: 3px 10px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .gallery-content {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.5s ease, opacity 0.3s ease;
        }

        .gallery-content.open {
            max-height: 10000px;
            opacity: 1;
            transition: max-height 0.5s ease, opacity 0.5s ease;
        }

        .content-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            grid-gap: 20px;
            margin: 20px 0;
            padding: 10px 0;
        }

        .video-item {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: #000;
        }

        .video-item:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0,0,0,0.25);
            z-index: 10;
        }

        .video-item video {
            width: 100%;
            height: 200px;
            object-fit: contain;
            display: block;
            background: #000;
        }

        .video-item video:fullscreen {
            object-fit: contain;
            width: 100vw;
            height: 100vh;
        }

        .video-item video:-webkit-full-screen {
            object-fit: contain;
            width: 100vw;
            height: 100vh;
        }

        .video-item video:-moz-full-screen {
            object-fit: contain;
            width: 100vw;
            height: 100vh;
        }

        .video-item video:-ms-fullscreen {
            object-fit: contain;
            width: 100vw;
            height: 100vh;
        }

        .video-title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 20px 15px 15px 15px;
            font-size: 0.9em;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .content-gallery {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                grid-gap: 15px;
                margin: 15px 0;
                padding: 8px 0;
            }
        }

        @media (max-width: 480px) {
            .content-gallery {
                grid-template-columns: 1fr;
                grid-gap: 15px;
                margin: 15px 0;
                padding: 8px 0;
            }
        }
    </style>
</head>

<body>
    <a href="/" class="back-link">‚Üê Back to Home</a>

    <!-- Water Color -->
    <div class="gallery-container">
        <div class="folder-header" onclick="toggleFolder('water-color')">
            <h2 class="folder-title">
                <span class="folder-arrow" id="water-color-arrow">‚ñ∂</span>
                üé® Water Color
            </h2>
            <span class="item-count" id="water-color-count">1 video</span>
        </div>
        <div class="gallery-content" id="water-color-content">
            <div class="content-gallery" id="water-color-gallery">
                <!-- Videos will be loaded here -->
            </div>
        </div>
    </div>

    <script>
      // Toggle folder open/close
      function toggleFolder(folderId) {
        const content = document.getElementById(folderId + '-content');
        const arrow = document.getElementById(folderId + '-arrow');

        if (content.classList.contains('open')) {
          content.classList.remove('open');
          arrow.classList.remove('open');
        } else {
          content.classList.add('open');
          arrow.classList.add('open');
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        // Function to create video items
        function createVideoItem(src, title) {
          const div = document.createElement('div');
          div.className = 'video-item';

          const video = document.createElement('video');
          video.controls = true;
          video.muted = true;
          video.loop = true;
          video.autoplay = false; // Disable autoplay initially
          video.preload = 'auto'; // Full preload for better seeking
          video.style.width = '100%';
          video.style.height = '200px';
          video.style.objectFit = 'contain';
          video.style.background = '#000';

          // Use direct src for .mov files (more reliable)
          video.src = src;

          let isSeeking = false;
          let seekTarget = 0;

          // Wait for video to fully load
          video.addEventListener('canplaythrough', function() {
            console.log('Video can play through');
            console.log('Buffered ranges:', video.buffered);

            // Try autoplay after fully loaded
            if (video.paused && !isSeeking) {
              video.play().catch(e => console.log('Autoplay failed:', e));
            }
          });

          video.addEventListener('loadedmetadata', function() {
            console.log('Metadata loaded, duration:', video.duration);
            video.currentTime = 0;
          });

          video.addEventListener('loadeddata', function() {
            console.log('Video data loaded');
            console.log('ReadyState:', video.readyState);
          });

          video.addEventListener('canplay', function() {
            console.log('Video can play');
          });

          video.addEventListener('progress', function() {
            console.log('Buffering progress...');
            for (let i = 0; i < video.buffered.length; i++) {
              console.log(`Buffered ${i}: ${video.buffered.start(i)} - ${video.buffered.end(i)}`);
            }
          });

          // Force seeking to work with .mov files
          let lastSeekTime = 0;
          let seekTimeout = null;

          video.addEventListener('seeking', function() {
            isSeeking = true;
            lastSeekTime = video.currentTime;
            console.log('Seeking to:', video.currentTime);
            seekTarget = video.currentTime;

            // Clear any existing timeout
            if (seekTimeout) {
              clearTimeout(seekTimeout);
            }

            // Force the seek to stick after a short delay
            seekTimeout = setTimeout(() => {
              if (Math.abs(video.currentTime - seekTarget) > 0.1) {
                console.log('Force seeking to target:', seekTarget);
                video.currentTime = seekTarget;
              }
            }, 50);
          });

          video.addEventListener('seeked', function() {
            console.log('Seeked to:', video.currentTime);
            console.log('Target was:', seekTarget);

            // Ensure we stay at the target position
            if (Math.abs(video.currentTime - seekTarget) > 0.1) {
              console.log('Position drift detected, correcting...');
              setTimeout(() => {
                video.currentTime = seekTarget;
              }, 10);
            }

            // Reset seeking flag after a delay
            setTimeout(() => {
              isSeeking = false;
            }, 100);
          });

          video.addEventListener('timeupdate', function() {
            // Special handling for .mov seeking issues
            if (isSeeking) {
              // Override any time changes during seeking
              if (seekTimeout) {
                clearTimeout(seekTimeout);
              }
              seekTimeout = setTimeout(() => {
                if (Math.abs(video.currentTime - seekTarget) > 0.1 && seekTarget > 0) {
                  console.log('Correcting drift during timeupdate');
                  video.currentTime = seekTarget;
                }
              }, 10);
              return;
            }

            // Store last valid time for seeking reference
            if (!isSeeking && video.currentTime > 0) {
              lastSeekTime = video.currentTime;
            }
          });

          // Add additional seek override for .mov files
          video.addEventListener('input', function(e) {
            // This might catch some control inputs
            console.log('Input event:', e);
          });

          // Handle click events on the progress bar area
          video.addEventListener('click', function(e) {
            const rect = video.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const clickPosition = x / rect.width;
            const seekTime = clickPosition * video.duration;

            if (seekTime !== video.currentTime) {
              console.log('Click seek to:', seekTime);
              video.currentTime = seekTime;
            }
          });

          video.addEventListener('play', function() {
            console.log('Video playing at:', video.currentTime);
          });

          video.addEventListener('pause', function() {
            console.log('Video paused at:', video.currentTime);
          });

          video.addEventListener('waiting', function() {
            console.log('Video waiting for data...');
          });

          // Error handling with retry
          video.addEventListener('error', function(e) {
            console.error('Video error:', e);
            console.error('Error code:', video.error ? video.error.code : 'unknown');

            // Try to reload video on error
            setTimeout(() => {
              console.log('Attempting to reload video...');
              video.load();
            }, 1000);
          });

          // Add custom seeking override after video loads
          video.addEventListener('loadstart', function() {
            console.log('Load started');
          });

          const titleDiv = document.createElement('div');
          titleDiv.className = 'video-title';
          titleDiv.textContent = title;

          div.appendChild(video);
          div.appendChild(titleDiv);

          return div;
        }

        // Load videos into galleries
        function loadGallery(folderId) {
          const gallery = document.getElementById(folderId + '-gallery');

          // Video data by folder
          const folderVideos = {
            'water-color': [
              {
                src: 'paint/water_color/christmas_snowman.mp4',
                title: 'Christmas Snowman'
              }
            ]
          };

          const videos = folderVideos[folderId] || [];
          videos.forEach(videoData => {
            gallery.appendChild(createVideoItem(videoData.src, videoData.title));
          });
        }

        // Initialize galleries
        loadGallery('water-color');
      });
    </script>

</body>
</html>